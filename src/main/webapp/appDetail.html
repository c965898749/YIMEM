<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>视频</title>
    <link rel="shortcut icon" href="statics/img/favicon.ico">
    <script src="js/setCookie.js"></script>
    <script src="jquery/jquery.js"></script>
    <link rel="stylesheet" href="css/siderBar2.css">
    <link rel="stylesheet" type="text/css" href="css/css.css"/>
    <link rel="stylesheet" type="text/css" href="layui/css/layui.css" media="all"/>
    <link rel="stylesheet" href="css/DPlayer.min.css">
    <link rel="stylesheet" href="css/video_detail.css">
    <script src="js/include.js"></script>
    <!--<script src="js/download.js"></script>-->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts/dist/echarts.min.js"></script>
    <style>

        #app_html {
            border-bottom: 2px red solid;
        }

        .bigtitle {

            pointer-events: none;
            cursor: not-allowed;
        }

    </style>
</head>

<body>
<div id="titleContai">
    <include src="title.html"></include>
</div>
<div class="TOP">
    <div class="TOP-nav">
        <div id="home" style="cursor:pointer;width: 200px;margin-left: -50px"><a href="app.html">返回视频首页</a></div>
    </div>
</div>
<div class="NAV">
    <div class="bodyz">
        <div class="left">
            <div class="title" style="height: 50px">
                <div class="bigtitle" style="font-size: 14px">
                </div>
            </div>


            <div class="video" style="background-image: url('imgs/loading/timg.gif');background-repeat:no-repeat;background-size:30%;background-position:center">
            </div>
            <div class="tools" style="margin-top: 10px">
                <div class="smallkuang" id="videoLike">
                    <i id="likeLike" class="layui-icon layui-icon-praise " style="font-size: 50px; color: grey;"></i>
                    点赞数 <span id="likeCount"></span>
                </div>
                <div class="smallkuang smallkuang2" style="margin-left: 40px">
                    <i id="collectCollect" class="layui-icon layui-icon-star-fill"
                       style="font-size: 50px; color: grey;"></i>
                    收藏数 <span id="collectCount"></span>
                </div>
                <div class="smallkuang" style="margin-top: 4px;margin-left: -10px;width: 170px">
                    <form class="layui-form" action="">
                        <div class="layui-form-item">
                            <label class="layui-form-label">弹幕</label>
                            <div class="layui-input-block">
                                <input type="checkbox" id="zzz" name="zzz" lay-skin="switch" lay-text="开启|关闭" checked>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="smallkuang" style="margin-left: 40px;display: flex">
                    <a href="https://movie.douban.com/" target="_blank">豆瓣分:</a>
                    <div id="test9" style="margin-top: -10px"></div>
                    <div class="douban" style="margin-top: 5px"></div>
                </div>
                <div class="smallkuang" style="margin-left: 30px;display: flex">
                    上映时间:
                    <div class="time"></div>
                </div>
                <div class="smallkuang" style="float: right;font-size: 14px;margin-top: 5px">
                    <div class="yuyan" style="background: #7ABDFF;color: white;padding: 4px"></div>
                </div>
            </div>
            <hr>
            <div class="jianjie">
                <span style='font-weight: bolder;margin-right: 5px'>剧情介绍:</span>
                <div class="neiron"></div>
            </div>
            <hr>
            <!--以下是评论页面-->
            <!--发表我的评论-->
            <div>
                <div class="talkNum">
                    共（<span id="commentsCount">0</span>）条评论
                </div>
                <!--评论发表框--->
                <div class="ImTalk">
                    <!--<img class="icon userInfoIcon" src="imgs/icons/blog/moren.png"/>-->
                    <div class="head">

                    </div>
                    <!--这里是头像-->

                    <div class="talkMess">
                    <textarea id="newCommMsg" placeholder="请自觉遵守互联网相关的政策法规，严禁发布色情、暴力、反动的言论" class="layui-textarea"
                              name="desc"></textarea>
                    </div>
                    <div class="button">
                        <button id="addComm" type="button" class="layui-btn layui-btn-primary layui-btn-lg"
                                style="background-color: #F44444;color: white">发表评论
                        </button>
                    </div>
                </div>

                <!--别人的评论-->
                <div class="otherTalk">
                    <div class="layui-tab layui-tab-brief" lay-filter="docDemoTabBrief">
                        <ul class="layui-tab-title">
                            <li class="layui-this">按热度排序</li>
                            <li>按时间排序</li>
                        </ul>
                        <div class="layui-tab-content" id="timeContent">
                            <!--按时间-->
                            <div class="layui-tab-item">
                                <div class="otherKuang"
                                     style="display: flex;background: white;margin-left: -20px;width: 1200px;padding-bottom: 10px">
                                    <img class="icon" src="imgs/icons/blog/moren.png">
                                    <div>
                                        <div style="width: 746px;height: 43px;padding: 5px;margin-left: 28px">
                                            赞我都每日好运
                                        </div>
                                        <div style="display: flex;margin-left: 28px;margin-top: 10px">
                                            <div style="margin-right: 20px"><i class="layui-icon layui-icon-praise"
                                                                               style="font-size: 14px; color: grey;">(2989990)赞</i>
                                            </div>
                                            <div style="margin-right: 20px"><i class="layui-icon layui-icon-tread"
                                                                               style="font-size: 14px; color: grey;">(5)踩</i>
                                            </div>
                                            <div style="margin-left: 390px;color: #00A1D6;margin-right: 10px">回复(2)</div>
                                            <div style="color: #00A1D6;margin-right: 10px">删除</div>
                                            <div style="margin-right: 10px;color:#999;">2019-06-07 06:48:38</div>
                                        </div>
                                    </div>

                                </div>
                            </div>
                            <div class="layui-tab-item">
                                <div class="otherKuang"
                                     style="display: flex;background: white;margin-left: -20px;width: 1200px;padding-bottom: 10px">
                                    <img class="icon" src="imgs/icons/blog/moren.png">
                                    <div>
                                        <div style="width: 746px;height: 43px;padding: 5px;margin-left: 28px">
                                            每日一水
                                        </div>
                                        <div style="display: flex;margin-left: 28px;margin-top: 10px">
                                            <div style="margin-right: 20px"><i class="layui-icon layui-icon-praise"
                                                                               style="font-size: 14px; color: grey;">(20)赞</i>
                                            </div>
                                            <div style="margin-right: 20px"><i class="layui-icon layui-icon-tread"
                                                                               style="font-size: 14px; color: grey;">(9999995)踩</i>
                                            </div>
                                            <div style="margin-left: 390px;color: #00A1D6;margin-right: 10px">回复(2)</div>
                                            <div style="color: #00A1D6;margin-right: 10px">删除</div>
                                            <div style="margin-right: 10px;color:#999;">2020-06-07 06:48:38</div>
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div>
                    </div>
                    <!--分页-->
                    <div id="demo7"></div>
                </div>
            </div>
        </div>
        <div class="right">
            <div class="Im" style="height: 40px">
                <!--<img class="icon" src="">-->
                <!--这是头像-->
                <!--<div class="name">-->
                <!--&lt;!&ndash;这是用户名&ndash;&gt;-->
                <!--</div>-->
                <!--<div class="remark">-->
                <!--&lt;!&ndash;这里是个签&ndash;&gt;-->
                <!--</div>-->

            </div>

            <!--以下是弹幕列表-->
            <div class="bullet" style="background: white;border: none">
                <div class="danmuTitle">
                    相关影片:
                </div>
                <div class="danmuList">
                </div>
            </div>
            <div class="yimem_bz" style="background-color: white;margin-top: 10px;">
                <div style="width:300px;margin:0 auto">
                    <img src="imgs/gz/gz.jpg" style="margin-top: 5px;margin-left: 30px;height: 100px;width: 100px"
                         alt="">
                    <img src="imgs/gz/eduwxfix.png" style="margin-top: 5px;margin-left: 30px;height: 100px;width: 100px"
                         alt="">
                </div>
                <div style="padding-bottom: 5px;margin: 0 auto;width: 250px ;border-bottom: 1px #E0E0E0 solid"><span
                        style="color:#8B8B8B;margin-left: 15px">YIMEM公众号</span><span
                        style="color:#8B8B8B;margin-left: 60px">IT学院</span></div>
                <div style="padding-top: 5px;margin: 0 auto;width: 250px"><span
                        style="color:#3D3D3D;font-weight: bold;margin-left: 20px">关于我们</span>
                    <span
                            style="color:#3D3D3D;margin-left: 20px">网站地图</span><span
                            style="color:#3D3D3D;margin-left: 20px">广告服务</span></div>
                <div style="width:300px;margin:0 auto; padding:20px 0;">
                    <img src="imgs/jh/jh.png" style="margin-left: 30px;margin-top: -15px" alt=""> <a target="_blank"
                                                                                                     href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=32061202001097"
                                                                                                     style="display:inline-block;text-decoration:none;height:20px;line-height:20px;"><img
                        src="" style="float:left;"/>
                    <p style="float:left;height:20px;line-height:20px;margin: 0px 0px 0px 5px; color:#939393;">苏公网安备
                        32061202001097号</p></a>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="layui/layui.all.js"></script>
<script>
    var rate = layui.rate;
    var videoid = getQueryString("videoid")
    var user = getUser();
    var userissd = 1;
    var page = 1;
    var i = 0;
    var state = 2;
    var director = "";
    var createtime = "";
    var region = "";
    var title = "";
    if (user) {
        userissd = user.userId
        $(".head").html(`<img class="icon userInfoIcon" src="${user.headImg}"/>`)

    } else {
        $(".head").html(`<img class="icon userInfoIcon" src="imgs/icons/blog/moren.png"/>`)
    }


    function ajaxGetInvitation(type) {
        $.ajax({
            url: "getVideo"
            ,
            type: "GET"
            ,
            data: {
                "pageNum": page,
                "state": state,
                "createtime": createtime,
                "director": director,
                "region": region,
                "type": type,
                "title": title
            }
            ,
            dataType: "json"
            // , async: false
            ,
            success: function (jsonData) {
                $(".danmuList").empty()
                var data = jsonData.data;
                var html = "";
                $.each(data, function (k, v) {
                    if (i < 3) {
                        html += ` <a href="/appDetail.html?videoid=${v.videoid}" target="_blank">
                        <ul class="danmuLi" style="height: 50px;margin-top: 15px">
                            <li>
                                <div class="currentTime" style="width: 37px;color: #888888 "><img style="height: 100%;width: 100%" src="${v.coverurl}" alt=""></div>
                            </li>
                            <li style="margin-left: 53px;margin-top: -25px">
                                <div class="msg" style="color: #888888 ">${v.title}</div>
                                <div class="createTime" style="color: #888888;transform:scale(0.8)">${v.createtime}</div>
                            </li>
                            <li style="margin-left: 53px;margin-top: 0px;color: #888888">
                                <div style="width: 220px;white-space: nowrap;text-overflow: ellipsis;overflow: hidden;">${v.info == null ? "" : v.info}</div>
                            </li>
                            <li> <hr style="margin-top: 20px"/></li>
                        </ul>
                    </a>`;
                    } else {
                        var yu = "英语";
                        if (v.director.substr(1, 2) != null) {
                            yu = v.director.substr(1, 2);
                        }
                        html += `<a href="/appDetail.html?videoid=${v.videoid}" target="_blank">
                       <ul class="danmuLi" style="height: 25px;margin-top: 15px">
                        <li>
                            <div class="currentTime" style="color: #888888 ">[${yu}]</div>
                            <div class="msg" style="color: #888888 ">${v.title}</div>
                            <div class="createTime" style="color: #888888;transform:scale(0.8)">${v.createtime}</div>
                            <hr style="margin-top: 0px"/>
                        </li>
                    </ul></a>`;
                    }
                    i++;
                    if (i == 12) {
                        return false;
                    }
                })
                $(".danmuList").append(html);
            }
            ,
            error: function (res) {
                //////////////////////////console.log("ajax提交错误")
            }
        })
    }

    function getvideo(videoid) {
        $.ajax({
            url: "getVideoById"
            , data: {"videoid": videoid}
            , type: "get"
            , dataType: "json"
            , success: function (jsonData) {
                //////////////////////////console.log(jsonData)

                if (jsonData.success == 1) {
                    var v = jsonData.data;
                    // $(".video").empty()
                    //////////////////////console.log(v)
                    var html = `<iframe  width="100%" height="100%" src="${v.videourl}" frameborder="0" border="0" marginwidth="0" marginheight="0" scrolling="no" allowfullscreen="true"></iframe>`;
                    var dq = v.region.replace(/:/g, " ")
                    var type = v.type.replace(/:/g, " ")
                    $(".bigtitle").html("前位置首页 > " + dq + " > " + type + " >" + v.title);
                    $(".neiron").append(v.info);
                    $(".video").append(html);
                    if (v.director != null) {
                        var y = v.director.replace(/:/g, " ")
                        $(".yuyan").append(y);
                    }

                    if (v.douban != null) {
                        $(".douban").append(v.douban);
                        douban(v.douban / 2);
                    } else {
                        $(".douban").css("margin-top", "0px")
                        $(".douban").css("margin-left", "5px")
                        $(".douban").html("暂无");

                    }
                    if (v.createtime != null) {
                        $(".time").append(v.createtime);
                        $(".time").css("margin-top", "4px")
                    } else {
                        $(".time").append("未知");
                    }
                    ajaxGetInvitation(v.type)

                }
            }
            , error: function (res) {
                //////////////////////////console.log("ajax提交错误")
            }
        })
    }

    $(function () {
        getvideo(videoid)
    })

    function douban(nub) {
        //只读
        rate.render({
            elem: '#test9'
            , value: nub
            , readonly: true
        });
    }

    function usr() {

    }

    function getQueryString(name) {
        var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i");
        var r = window.location.search.substr(1).match(reg);
        if (r != null) return r[2];
        return null;
    }

    $(".layui-input-block").on("click", function () {

        if ($("#zzz").prop("checked")) {
            dp.danmaku.show()
        } else {
            dp.danmaku.hide()
        }
    })

    $("#likeLike").on("click", function () {


        alert("功能建设中……敬请期待");


    })
    $("#collectCollect").on("click", function () {


        alert("功能建设中……敬请期待");


    })

    //获取当前用户
    function getUser() {
        var data;
        $.ajax({
            url: "isEnter"
            , type: "get"
            , dataType: "json"
            , async: false
            , success: function (jsonData) {
                ////////////////console.log(jsonData)
                if (jsonData.success == 1) {
                    data = jsonData.data;
                }
            }
            , error: function (res) {
                ////////////////console.log("ajax提交错误")
            }
        })
        return data;
    }


</script>
</body>

</html>
